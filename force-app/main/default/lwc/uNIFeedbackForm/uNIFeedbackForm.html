<template>
    <lightning-card>
        <!-- Header -->
        <div slot="title">
            <lightning-icon icon-name="standard:feedback" size="small"></lightning-icon>
            <span class="slds-m-left_small">Learning from Your Experience</span>
        </div>

        <!-- Card Body -->
        <div class="slds-p-around_medium">

            <!-- Feedback already submitted message -->
            <template if:true={isSubmitted}>
                <div class="slds-box slds-theme_success slds-m-around_medium">
                    <p class="slds-text-heading_small">âœ… Feedback Submitted Successfully!</p>
                    <template if:true={submittedBy}>
                        <p class="slds-m-top_x-small">Submitted by: <strong>{submittedBy}</strong></p>
                    </template>
                    <template if:true={submittedDate}>
                        <p>Submitted on: <strong>{formattedSubmittedDate}</strong></p>
                    </template>
                </div>
            </template>

            <!-- Process Type Display -->
            <div class="slds-text-heading_small slds-m-bottom_small">
                Related process: <strong>{processType}</strong>
            </div>

            <!-- Instructions -->
            <div class="slds-text-body_regular slds-m-bottom_large instruction-box">
                <p>
                    In the form below, please provide your feedback and reflections from the process you recently
                    completed,
                    in order to help us learn from your experience and continuously improve our work.
                    When you are done, please click the <strong>Submit</strong> button.
                </p>
            </div>

            <!-- Show spinner while loading -->
            <template if:true={isLoading}>
                <lightning-spinner alternative-text="Loading feedback form..."></lightning-spinner>
            </template>

            <!-- Show error if any -->
            <template if:true={errorMessage}>
                <div class="slds-m-bottom_medium">
                    <div class="slds-notify slds-notify_alert slds-alert_error" role="alert">
                        <span class="slds-assistive-text">error</span>
                        <h2>{errorMessage}</h2>
                    </div>
                </div>
            </template>



            <!-- Feedback Form -->
            <template if:false={isLoading}>
                <div class="feedback-form">
                    <template for:each={feedbackResponses} for:item="response">
                        <div key={response.feedbackId} class="feedback-question slds-m-bottom_large">

                            <!-- Question Number and Category -->
                            <div class="slds-text-heading_medium slds-m-bottom_x-small">
                                {response.sequence}. {response.category}
                            </div>

                            <!-- Question Text -->
                            <div class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">
                                {response.questionText}
                            </div>

                            <!-- Response Text Area -->
                            <lightning-textarea data-feedback-id={response.feedbackId} name={response.feedbackId}
                                value={response.responseValue} onchange={handleResponseChange} rows="6"
                                placeholder="Enter your feedback here (optional)..." class="response-textarea">
                            </lightning-textarea>
                        </div>
                    </template>
                </div>

                <!-- Action Buttons (only show when NOT submitted) -->
                <div class="slds-m-top_large slds-text-align_right">
                    <lightning-button label="Save Draft" variant="neutral" onclick={handleSaveDraft} disabled={isSaving}
                        class="slds-m-right_small">
                    </lightning-button>

                    <lightning-button label="Submit" variant="brand" onclick={handleSubmit} disabled={isSaving}>
                    </lightning-button>
                </div>

            </template>
        </div>
    </lightning-card>
</template>